/*!
 * jQuery ClassyLightbox
 * www.class.pm
 *
 * Written by Marius Stanciu - Sergiu <marius@class.pm>
 * Licensed under the MIT license www.class.pm/LICENSE-MIT
 * Version 1.1.0
 *
 */
(function(c,t,s){var q=!1,r=function(a){return function(b){return a.search(b)}}(navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"");-1<r("mobile")&&(-1<r("android")||-1<D("googletv")||-1<D("htc_flyer"))&&(q=!0);-1<r("opera")&&-1<D("mini")&&-1<D("mobi")&&(q=!0);-1<r("iphone")&&(q=!0);-1<r("windows phone os 7")&&(q=!0);c.extend(c.easing,{easeOutBackMin:function(a,b,c,d,g,f){f=1;return d*((b=b/g-1)*b*((f+1)*b+f)+1)+c}});"undefined"===typeof c.fn.live&&(c.fn.live=function(a,b,c){jQuery(this.context).on(a, this.selector,b,c);return this});c.extend({ClassyLightbox:{defaults:{style:{zIndex:99999,width:470,height:280},modal:!1,overlay:{opacity:0.6},animation:{show:{duration:400,easing:"easeOutBackMin"},close:{duration:200,easing:"easeOutBackMin"},move:{duration:700,easing:"easeOutBackMin"},shake:{duration:100,easing:"easeOutBackMin",distance:10,loops:2}},flash:{width:640,height:360},iframe:{width:640,height:360},maxSize:{width:-1,height:-1},preload:!0,from:"top",ajax:{type:"GET",cache:!1,dataType:"html"}}, options:{},animations:{},gallery:{},image:{},template:{lightbox:[],buttons:{close:[],prev:[],max:[],next:[]},background:[],image:[],title:[],html:[]},visible:!1,maximized:!1,mode:"image",videoregs:{swf:{reg:/[^\.]\.(swf)\s*$/i},youtu:{reg:/youtu\.be\//i,split:"/",index:3,iframe:1,url:"http://www.youtube.com/embed/%id%?autoplay=1&amp;fs=1&amp;rel=0&amp;enablejsapi=1"},youtube:{reg:/youtube\.com\/watch/i,split:"=",index:1,iframe:1,url:"http://www.youtube.com/embed/%id%?autoplay=1&amp;fs=1&amp;rel=0&amp;enablejsapi=1"}, vimeo:{reg:/vimeo\.com/i,split:"/",index:3,iframe:1,url:"http://player.vimeo.com/video/%id%?hd=1&amp;autoplay=1&amp;show_title=1&amp;show_byline=1&amp;show_portrait=0&amp;color=&amp;fullscreen=1"},metacafe:{reg:/metacafe\.com\/watch/i,split:"/",index:4,url:"http://www.metacafe.com/fplayer/%id%/.swf?playerVars=autoPlay=yes"},dailymotion:{reg:/dailymotion\.com\/video/i,split:"/",index:4,iframe:!0,url:"http://www.dailymotion.com/embed/video/%id%?autoPlay=1&forcedQuality=hd720"},ustream:{reg:/ustream\.tv/i, split:"/",index:4,url:"http://www.ustream.tv/flash/video/%id%?loc=%2F&amp;autoplay=true&amp;vid=%id%&amp;disabledComment=true&amp;beginPercent=0.5331&amp;endPercent=0.6292&amp;locale=en_US"},twitvid:{reg:/twitvid\.com/i,split:"/",index:3,url:"http://www.twitvid.com/player/%id%"},wordpress:{reg:/v\.wordpress\.com/i,split:"/",index:3,url:"http://s0.videopress.com/player.swf?guid=%id%&amp;v=1.01"}},mapsreg:{bing:{reg:/bing\.com\/maps/i,split:"?",index:1,url:"http://www.bing.com/maps/embed/?emid=3ede2bc8-227d-8fec-d84a-00b6ff19b1cb&amp;w=%width%&amp;h=%height%&amp;%id%"}, streetview:{reg:/maps\.google\.(com|co.uk|ca|es)(.*)layer=c/i,split:"?",index:1,url:"http://maps.google.com/?output=svembed&amp;%id%"},googlev2:{reg:/maps\.google\.(com|co.uk|ca|es)\/maps\/ms/i,split:"?",index:1,url:"http://maps.google.com/maps/ms?output=embed&amp;%id%"},google:{reg:/maps\.google\.(com|co.uk|ca|es)/i,split:"?",index:1,url:"http://maps.google.com/maps?%id%&amp;output=embed"}},imgsreg:/\.(?:jpg|png|jpeg|gif|bmp|tiff)/i,overlay:{_create:function(a){this.options=a;this.element=c('<div id="'+ (new Date).getTime()+'" class="lightbox-overlay"></div>');this.element.css(c.extend({},{position:"fixed",top:0,left:0,opacity:0,display:"none","z-index":this.options.zIndex},this.options.style));this.element.bind("click",c.proxy(function(b){this.options.modal||this.hidden||(c.isFunction(this.options.callback)?this.options.callback():this.hide());b.preventDefault()},this));this.hidden=!0;this._build();return this},_build:function(){this.target=c(s.body);this.target.append(this.element)},_resize:function(a, b){this.element.css({height:0,width:0});this.shim&&this.shim.css({height:0,width:0});c(s).width();var e=c(s).height();this.element.css({width:"100%",height:b||e});this.shim&&(this.shim.css({height:0,width:0}),this.shim.css({position:"absolute",left:0,top:0,width:this.element.width(),height:b||e}));return this},show:function(a){if(!this.hidden)return this;this.transition&&this.transition.stop();this.shim&&this.shim.css("display","block");this.element.css({display:"block",opacity:0});this._resize(); this.hidden=!1;this.transition=this.element.fadeTo(this.options.showDuration,this.options.style.opacity,c.proxy(function(){this.options.style.opacity&&this.element.css(this.options.style);this.element.trigger("show");c.isFunction(a)&&a()},this));return this},hide:function(a){if(this.hidden)return this;this.transition&&this.transition.stop();this.shim&&this.shim.css("display","none");this.hidden=!0;this.transition=this.element.fadeTo(this.options.closeDuration,0,c.proxy(function(){this.element.trigger("hide"); c.isFunction(a)&&a();this.element.css({height:0,width:0,display:"none"})},this));return this}},_create:function(a){this.options=c.extend(!0,this.defaults,a);a=c('<div class="lightbox mode-image"><div class="border-top-left"></div><div class="border-top-middle"></div><div class="border-top-right"></div><a class="close" href="#close"><span>close</span></a><div class="navigator"><a class="left" href="#"><span>previous</span></a><a class="right" href="#"><span>next</span></a></div><div class="buttons"><div class="init"></div><a class="left" href="#"><span>previous</span></a><a class="max" href="#"><span>maximize</span></a><div class="custom"></div><a class="right" href="#"><span>next</span></a><div class="end"></div></div><div class="background"></div><div class="lightbox-html"></div><div class="border-bottom-left"></div><div class="border-bottom-middle"></div><div class="border-bottom-right"></div></div>'); var b=this.template;this.overlay._create({style:this.options.overlay,modal:this.options.modal,zIndex:this.options.style.zIndex-1,callback:this.proxy(this.close),showDuration:q?this.options.animation.show.duration/2:this.options.animation.show.duration,closeDuration:q?this.options.animation.close.duration/2:this.options.animation.close.duration});b.lightbox=a;b.navigator=c(".navigator",a);b.buttons.div=c(".buttons",a);b.buttons.close=c(".close",a);b.buttons.prev=c(".left",a);b.buttons.max=c(".max", a);b.buttons.next=c(".right",a);b.buttons.custom=c(".custom",a);b.background=c(".background",a);b.html=c(".lightbox-html",a);b.move=c('<div class="lightbox-move"></div>').css({position:"absolute","z-index":this.options.style.zIndex,top:-999}).append(a);c("body").append(b.move);this.win=c(t);this._setupEvents();return a},_setupEvents:function(){this.win[0].onorientationchange=function(){this.visible&&(this.overlay._resize(),this.move&&!this.maximized&&this._move())};this.win.bind("resize",this.proxy(function(){this.visible&& !q&&(this.overlay._resize(),this.move&&!this.maximized&&this._move())}));this.win.bind("scroll",this.proxy(function(){this.visible&&this.move&&!this.maximized&&!q&&this._move()}));c(s).bind("keydown",this.proxy(function(a){this.visible&&(27===a.keyCode&&!1===this.options.modal&&this.close(),1<this.gallery.total&&(37===a.keyCode&&this.template.buttons.prev.triggerHandler("click",a),39===a.keyCode&&this.template.buttons.next.triggerHandler("click",a)))}));this.template.buttons.close.bind("click touchend", {fn:"close"},this.proxy(this.fn));this.template.buttons.max.bind("click touchend",{fn:"_cascade"},this.proxy(this.fn));this.overlay.element.bind("show",this.proxy(function(){c(this).triggerHandler("show")}));this.overlay.element.bind("hide",this.proxy(function(){c(this).triggerHandler("close")}))},fn:function(a){this[a.data.fn].apply(this);a.preventDefault()},proxy:function(a){return c.proxy(a,this)},ex:function(a,b,e){var d={type:"",width:"",height:"",href:""};c.each(a,this.proxy(function(a,f){c.each(f, this.proxy(function(c,f){if("flash"===a&&b.split("?")[0].match(f.reg)||"iframe"===a&&b.match(f.reg)){d.href=b;if(f.split){var k="flash"===a?b.split(f.split)[f.index].split("?")[0].split("&")[0]:b.split(f.split)[f.index];d.href=f.url.replace("%id%",k).replace("%width%",e.width).replace("%height%",e.height)}d.type=f.iframe?"iframe":a;e.width?(d.width=e.width,d.height=e.height):(k=this._calc(this.options[d.type].width,this.options[d.type].height),d.width=k.width,d.height=k.height);return!1}}));if(d.type)return!1})); return d},_gallery:function(a,b){var c=this,d=c.template.buttons.prev,g=c.template.buttons.next;c.gallery.total=a.length;1<a.length?(d.unbind(".lightbox"),g.unbind(".lightbox"),d.bind("click.lightbox touchend.lightbox",function(b){b.preventDefault();a.unshift(a.pop());c.show(a)}),g.bind("click.lightbox touchend.lightbox",function(b){b.preventDefault();a.push(a.shift());c.show(a)}),"none"===c.template.navigator.css("display")&&c.template.buttons.div.show(),d.show(),g.show(),this.options.preload&&(a[1].href.match(this.imgsreg)&& ((new Image).src=a[1].href),a[a.length-1].href.match(this.imgsreg)&&((new Image).src=a[a.length-1].href))):(d.hide(),g.hide())},_setupCustomButtons:function(a,b){var e=this.template;e.buttons.custom.empty();c.each(a,this.proxy(function(a,g){var f=c('<a href="#" class="'+g["class"]+'">'+g.html+"</a>");f.bind("click",this.proxy(function(a){c.isFunction(g.callback)&&g.callback(this.template.image.src,this,b);a.preventDefault()}));e.buttons.custom.append(f)}));e.buttons.div.show()},show:function(a,b, e){if(this.isEmpty(a))return!1;var d=this.win.width(),g=this.win.height(),f=a[0],h="",p=!1,k=f.href,m=this.template,l,n;1===a.length&&"element"===f.type&&(h="element");this._setupLoading();p=this.visible;this.open();!1===p&&this._move();this._gallery(a,b);b=c.extend(!0,{width:0,height:0,modal:!1,force:"",autoresize:!0,move:!0,maximized:!1,iframe:!1,flashvars:"",ratio:1,onOpen:function(){},onClose:function(){}},b||{},f);this.options.onOpen=b.onOpen;this.options.onClose=b.onClose;a=this._unserialize(k); b=c.extend({},b,a);b.width&&0<(""+b.width).indexOf("p")&&(b.width=Math.round((d-20)*b.width.substring(0,b.width.indexOf("p"))/100));b.height&&0<(""+b.height).indexOf("p")&&(b.height=Math.round((g-20)*b.height.substring(0,b.height.indexOf("p"))/100));this.overlay.options.modal=b.modal;d=m.buttons.max;d.removeClass("min");d.removeClass("max");d.addClass("lightbox-hide");this.move=!!b.move;this.maximized=!!b.maximized;c.isArray(b.buttons)&&this._setupCustomButtons(b.buttons,f.element);!1===m.buttons.custom.is(":empty")&& m.buttons.div.show();!1===this.isEmpty(b.force)?h=b.force:b.iframe?h="iframe":k.match(this.imgsreg)?h="image":(d=this.ex({flash:this.videoregs,iframe:this.mapsreg},k,b),!0===!!d.type&&(k=d.href,h=d.type,b.width=d.width,b.height=d.height),!1===!!h&&(k.match(/#/)?(d=k.substr(k.indexOf("#")),0<c(d).length?(h="inline",k=d):h="ajax"):h="ajax"));if("image"===h)m.image=new Image,c(m.image).load(this.proxy(function(){var a=this.template.image;c(a).unbind("load");if(!1===this.visible)return!1;if(b.width)l= parseInt(b.width,10),n=parseInt(b.height,10),b.autoresize=!1;else if(a.width=parseInt(a.width*b.ratio,10),a.height=parseInt(a.height*b.ratio,10),b.maximized)l=a.width,n=a.height;else{var d=this._calc(a.width,a.height);l=d.width;n=d.height}b.autoresize&&(b.maximized||!b.maximized&&a.width!=l&&a.height!=n)&&(m.buttons.div.show(),m.buttons.max.removeClass("lightbox-hide"),m.buttons.max.addClass(b.maximized?"min":"max"));m.title=this.isEmpty(b.title)?!1:c('<div class="title"></div>').html(b.title);this._setupImage(); this._resize(l,n)})),this.template.image.onerror=this.proxy(function(){this.error("The requested image cannot be loaded.")}),this.template.image.src=k;else if("jwplayer"===h&&"undefined"!==typeof jwplayer){if(b.width)l=b.width,n=b.height;else return this.error("You have to specify the size."),!1;var q="DV_"+(new Date).getTime();this._setupHTML(c('<div id="'+q+'"></div>').css({width:l,height:n}),l,n);this.template.background.bind("complete",this.proxy(function(){this.template.background.unbind("complete"); jwplayer(q).setup(c.extend(!0,{file:k,autostart:!0},b));if(!1===this.visible)return!1}))}else if("flash"===h||"inline"===h||"ajax"===h||"element"===h)if("inline"===h)f=c(k),h="original"===b.source?f:f.clone(!0).show(),l=0<b.width?b.width:f.outerWidth(!0),n=0<b.height?b.height:f.outerHeight(!0),this._setupHTML(h,l,n);else if("ajax"===h){if(b.width)l=b.width,n=b.height;else return this.error("You have to specify the size."),!1;this.animations.ajax&&this.animations.ajax.abort();this.animations.ajax= c.ajax(c.extend(!0,{},this.options.ajax,b.ajax||{},{url:k,error:this.proxy(function(a,b,c){this.error("AJAX Error "+a.status+" "+c+". Url: "+k)}),success:this.proxy(function(a){this._setupHTML(c("<div>"+a+"</div>"),l,n)})}))}else"flash"===h?(f=this.swf2html(k,b.width,b.height,b.flashvars),this._setupHTML(c(f),b.width,b.height,"flash")):"element"===h&&(l=0<b.width?b.width:f.element.outerWidth(!0),n=0<b.height?b.height:f.element.outerHeight(!0),this._setupHTML(f.element,l,n));else if("iframe"===h){if(b.width)l= b.width,n=b.height;else return this.error("You have to specify the size."),!1;f='<iframe id="IF_'+(new Date).getTime()+'" frameborder="0" src="'+k+'" style="margin:0; padding:0;"></iframe>';this._setupHTML(c(f).css({width:l,height:n}),l,n)}this.callback=c.isFunction(e)?e:function(a){}},_setupImage:function(){var a=this.template,b=a.background;b.bind("complete",this.proxy(function(){b.unbind("complete");if(!1===this.visible)return!1;this._setupMode("image");b.empty();a.html.empty();a.title&&b.append(a.title); b.append(a.image);c(a.image).css("background-color","rgba(255, 255, 255, 0)");c(a.image).stop().css("opacity",0).animate({opacity:1},q?this.options.animation.show.duration/2:this.options.animation.show.duration,function(){b.removeClass("loading")});this.options.onOpen.apply(this)}))},swf2html:function(a,b,e,d){a=c.extend(!0,{classid:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",width:b,height:e,movie:a,src:a,style:"margin:0; padding:0;",allowFullScreen:"true",allowscriptaccess:"always",wmode:"transparent", autostart:"true",autoplay:"true",type:"application/x-shockwave-flash",flashvars:"autostart=1&autoplay=1&fullscreenbutton=1"},d);var g="<object ",f="<embed ",h="";c.each(a,function(a,b){""!==b&&(g+=a+'="'+b+'" ',f+=a+'="'+b+'" ',h+='<param name="'+a+'" value="'+b+'"></param>')});return g+">"+h+f+"></embed></object>"},_setupHTML:function(a,b,c,d){var g=this.options,f=this.template,h=f.background;this._setupMode("html");this._resize(b+30,c+20);h.bind("complete",function(){h.removeClass("loading");f.html.append(a); "flash"===d&&-1<D("chrome")&&f.html.html(a);h.unbind("complete");g.onOpen.apply(this)})},_move:function(a,b){var e=c(this.win),d=this.template,g=null!=a?a:d.lightbox.outerWidth(!0),f=null!=b?b:d.lightbox.outerHeight(!0),h=0,p=0,k=e.width(),m=e.height(),p=e.scrollLeft(),e=e.scrollTop(),p=p+(k-g)/2;this.visible?h=e+(m-f)/2:"bottom"===this.options.from?h=e+m+14:"top"===this.options.from?h=e-f-14:"right"===this.options.from?(p=k,h=e+(m-f)/2):"left"===this.options.from&&(p=-g,h=e+(m-f)/2);this.visible? (this.animations.move||this._morph(d.move,{left:parseInt(p,10)},"move"),this._morph(d.move,{top:parseInt(h,10)},"move")):d.move.css({left:parseInt(p,10),top:parseInt(h,10)})},_morph:function(a,b,e,d,g){a.animate(b,{queue:g||!1,duration:q?this.options.animation[e].duration/2:this.options.animation[e].duration,easing:this.options.animation[e].easing,complete:c.isFunction(d)?this.proxy(d,this):null})},_resize:function(a,b){var e=this.template;if(this.visible){var d=c(this.win).width(),g=c(this.win).height(), f=c(this.win).scrollLeft(),h=c(this.win).scrollTop(),d=Math.max(f+(d-(a+14))/2,0),f=Math.max(h+(g-(b+14))/2,0);this.animations.move=!0;this._morph(e.move.stop(),{left:this.maximized&&0>d?0:d,top:this.maximized&&b+14>g?h:f},"move",c.proxy(function(){this.move=!1},this.animations));this._morph(e.html,{height:b-20},"move");this._morph(e.lightbox.stop(),{width:a+14,height:b-20},"move",{},!0);this._morph(e.navigator,{width:a},"move");this._morph(e.navigator,{top:(b-e.navigator.height())/2},"move");this._morph(e.background.stop(), {width:a,height:b},"move",function(){c(e.background).trigger("complete")})}else e.html.css({height:b-20}),e.lightbox.css({width:a+14,height:b-20}),e.background.css({width:a,height:b}),e.navigator.css({width:a})},close:function(a){var b=this.template;this.visible=!1;this.gallery={};this.options.onClose();var e=b.html.children(".jwplayer");0<e.length&&"undefined"!==typeof jwplayer&&jwplayer(e[0]).remove();q?(b.background.empty(),b.html.find("iframe").attr("src",""),b.html.hide().empty().show(),b.buttons.custom.empty(), b.move.css("display","none"),this._move()):b.move.animate({opacity:0,top:"-=40"},{queue:!1,complete:this.proxy(function(){b.background.empty();b.html.empty();b.buttons.custom.empty();this._move();b.move.css({display:"none",opacity:1,overflow:"visible"})})});this.overlay.hide(this.proxy(function(){c.isFunction(this.callback)&&this.callback.apply(this,c.makeArray(a))}));b.background.stop(!0,!1).unbind("complete")},open:function(){this.visible=!0;this.template.move.stop().css({opacity:1,display:"block", overflow:"visible"}).show();this.overlay.show()},shake:function(){for(var a=this.options.animation.shake,b=a.distance,c=a.duration,d=a.transition,a=a.loops,g=this.template.move.position().left,f=this.template.move,h=0;h<a;h++)f.animate({left:g+b},c,d),f.animate({left:g-b},c,d);f.animate({left:g+b},c,d);f.animate({left:g},c,d)},_setupMode:function(a){a!==this.mode&&(this.template.lightbox.removeClass("mode-"+this.mode).addClass("mode-"+a),this.mode=a);this.template.move.css("overflow","visible")}, error:function(a){alert(a);this.close()},_unserialize:function(a){var b=/lightbox\[([^\]]*)?\]$/i,e={};a.match(/#/)&&(a=a.slice(0,a.indexOf("#")));a=a.slice(a.indexOf("?")+1).split("&");c.each(a,function(){var a=this.split("="),c=a[0],a=a[1];c.match(b)&&(isFinite(a)?a=parseFloat(a):"true"==a.toLowerCase()?a=!0:"false"==a.toLowerCase()&&(a=!1),e[c.match(b)[1]]=a)});return e},_calc:function(a,b){var c=0<this.options.maxSize.width?this.options.maxSize.width:this.win.width()-50,d=0<this.options.maxSize.height? this.options.maxSize.height:this.win.height()-50;a>c?(b*=c/a,a=c,b>d&&(a*=d/b,b=d)):b>d&&(a*=d/b,b=d,a>c&&(b*=c/a,a=c));return{width:parseInt(a,10),height:parseInt(b,10)}},_setupLoading:function(){var a=this.options.style,b=this.template,c=b.background;this._setupMode("image");c.children().stop(!0);c.empty();b.html.empty();b.buttons.div.hide();b.buttons.div.css("width");c.addClass("loading");!1===this.visible&&(this._move(a.width,a.height),this._resize(a.width,a.height))},_cascade:function(){var a= this.template.buttons,b=this.template.image,c={};a.max.removeClass("min max").addClass(this.maximized?"max":"min");this._setupLoading();this._setupImage();a.div.show();c=this.maximized?this._calc(b.width,b.height):b;this._resize(c.width,c.height);this.maximized=!this.maximized},getOptions:function(a){a=c(a);return c.extend({},{href:a.attr("href"),rel:c.trim(a.attr("data-rel")||a.attr("rel")),relent:a.attr("data-rel")?"data-rel":"rel",title:c.trim(a.attr("data-title")||a.attr("title")),element:a[0]}, c.parseJSON((a.attr("data-options")||"{}").replace(/\'/g,'"'))||{})},link:function(a,b){var e=c(b.element),d=this.getOptions(e),g=d.rel,f=d.relent,h=b.options,p=[];e.blur();if(b.gallery)p=b.gallery;else if(this.isEmpty(g)||"nofollow"===g)p=[d];else{var k=[],m=[],l=!1;c("a["+f+"], area["+f+"]",this.ownerDocument).filter("["+f+'="'+g+'"]').each(c.proxy(function(a,b){e[0]===b?(k.unshift(this.getOptions(b)),l=!0):!1===l?m.push(this.getOptions(b)):k.push(this.getOptions(b))},this));p=k.concat(m)}c.lightbox(p, h,b.callback,e);return!1},isEmpty:function(a){if(null==a)return!0;if("[object String]"===Object.prototype.toString.call(a)||"array"===c.type(a))return 0===a.length}},lightbox:function(a,b,e){var d=[];if(c.ClassyLightbox.isEmpty(a))return c.ClassyLightbox;if("string"===c.type(a))d=[c.extend({},{href:a},b)];else if("array"===c.type(a)){var g=a[0];if("string"===c.type(g))for(g=0;g<a.length;g++)d[g]=c.extend({},{href:a[g]},b);else if("object"===c.type(g))for(g=0;g<a.length;g++)d[g]=c.extend({},b,a[g])}else"object"=== c.type(a)&&a[0].nodeType&&(d=[c.extend({},{type:"element",href:"#",element:a},b)]);return c.ClassyLightbox.show(d,b,e)}});c.fn.lightbox=function(a,b){return c(this).live("click",function(e){e.preventDefault();e.stopImmediatePropagation();return c.proxy(c.ClassyLightbox.link,c.ClassyLightbox)(e,c.extend({},{selector:this.selector,options:a,callback:b},{element:this}))})};c(function(){c.ClassyLightbox._create()})})(jQuery,window,document);